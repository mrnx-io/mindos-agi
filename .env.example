# =============================================================================
# MindOS 10/10 SOTA AGI Architecture - Environment Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Core Settings
# -----------------------------------------------------------------------------
NODE_ENV=development
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Database (Postgres + pgvector)
# -----------------------------------------------------------------------------
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/mindos
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=mindos

# -----------------------------------------------------------------------------
# Restate Durable Orchestration
# -----------------------------------------------------------------------------
RESTATE_INGRESS_URL=http://restate:8080
RESTATE_DEPLOYMENT_URL=http://mind-service:8080
RESTATE_ADMIN_URL=http://restate:9070

# -----------------------------------------------------------------------------
# Model API Keys (Multi-Model Cognition)
# -----------------------------------------------------------------------------
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GOOGLE_AI_API_KEY=...
XAI_API_KEY=xai-...

# -----------------------------------------------------------------------------
# Model Routing Configuration
# -----------------------------------------------------------------------------
# Primary models (must match MODEL_CONFIGS keys in config.ts)
MODEL_PRIMARY=gpt-5.2
MODEL_FALLBACK_1=claude-opus-4-5-20251101
MODEL_FALLBACK_2=gemini-3-pro
MODEL_FAST=gpt-5.2-mini

# Role-specific model overrides (optional, uses MODEL_PRIMARY if not set)
# MODEL_PLANNER=gpt-5.2
# MODEL_VERIFIER=gpt-5.2
# MODEL_WRITER=claude-opus-4-5-20251101
# MODEL_TOOLCALLER=grok-4-1-fast
# MODEL_METACOGNITION=claude-opus-4-5-20251101
# MODEL_REASONING=grok-4-1-fast-reasoning

# -----------------------------------------------------------------------------
# Embedding Configuration
# -----------------------------------------------------------------------------
EMBEDDING_MODEL=text-embedding-3-large
EMBEDDING_DIMENSIONS=3072

# -----------------------------------------------------------------------------
# Autonomy Thresholds
# -----------------------------------------------------------------------------
RISK_AUTO_EXECUTE_MAX=0.35
RISK_REQUIRE_APPROVAL_MIN=0.60
MAX_AGENT_ITERS=20
CONFIDENCE_THRESHOLD=0.75

# -----------------------------------------------------------------------------
# Service Ports
# -----------------------------------------------------------------------------
MIND_SERVICE_PORT=8080
TOOLMESH_PORT=9000
EXECUTOR_PORT=9100
GROUNDING_SERVICE_PORT=9200
DRIFT_MONITOR_PORT=9300
SWARM_COORDINATOR_PORT=9400

# -----------------------------------------------------------------------------
# ToolMesh Gateway
# -----------------------------------------------------------------------------
TOOLMESH_URL=http://toolmesh:9000
TOOLMESH_TOKEN=change-me-minimum-32-characters-long
TOOLMESH_REFRESH_ON_BOOT=true

# -----------------------------------------------------------------------------
# Executor Sandbox
# -----------------------------------------------------------------------------
EXECUTOR_URL=http://executor:9100
EXECUTOR_TOKEN=change-me-minimum-32-characters-long
EXECUTOR_MAX_TOOL_CALLS=12
EXECUTOR_MAX_SEARCH_CALLS=4
EXECUTOR_TIMEOUT_MS=60000
EXECUTOR_MAX_CODE_SIZE=40000

# -----------------------------------------------------------------------------
# Grounding Service
# -----------------------------------------------------------------------------
GROUNDING_SERVICE_URL=http://grounding-service:9200
GROUNDING_TOKEN=change-me-minimum-32-characters-long
GROUNDING_CONFIDENCE_THRESHOLD=0.80
GROUNDING_MODEL=gpt-5.2-mini

# -----------------------------------------------------------------------------
# Drift Monitor
# -----------------------------------------------------------------------------
DRIFT_MONITOR_URL=http://drift-monitor:9300
DRIFT_CHECK_INTERVAL_MS=3600000
DRIFT_QUALITY_THRESHOLD=0.85
DRIFT_MONITORED_MODELS=gpt-5.2,gpt-5.2-mini,claude-opus-4-5-20251101,gemini-3-pro

# -----------------------------------------------------------------------------
# Swarm Coordinator
# -----------------------------------------------------------------------------
SWARM_COORDINATOR_URL=http://swarm-coordinator:9400
SWARM_CONSENSUS_TIMEOUT_MS=30000
SWARM_MAX_AGENTS=10

# -----------------------------------------------------------------------------
# Knowledge Graph (Graphiti MCP)
# -----------------------------------------------------------------------------
GRAPHITI_MCP_URL=http://graphiti:8000/mcp/
GRAPHITI_ENABLED=true

# -----------------------------------------------------------------------------
# Observability
# -----------------------------------------------------------------------------
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4318
LANGFUSE_PUBLIC_KEY=
LANGFUSE_SECRET_KEY=
LANGFUSE_HOST=https://cloud.langfuse.com

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
JWT_SECRET=change-me-to-a-secure-random-string
CORS_ORIGINS=http://localhost:3000
RATE_LIMIT_REQUESTS_PER_MINUTE=100

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
ENABLE_METACOGNITION=true
ENABLE_WORLD_MODEL=true
ENABLE_SWARM=true
ENABLE_GROUNDING=true
ENABLE_DRIFT_MONITORING=true
ENABLE_IDENTITY_EVOLUTION=true

# -----------------------------------------------------------------------------
# xAI Agent Tools Configuration
# -----------------------------------------------------------------------------
# Enable xAI's server-side Agent Tools (web_search, x_search, code_execution)
XAI_ENABLE_AGENT_TOOLS=true

# Comma-separated list of enabled tools: web_search,x_search,code_execution,collections_search,mcp
XAI_AGENT_TOOLS_ENABLED=web_search,x_search,code_execution,mcp

# Prefer xAI Agent Tools over MindOS services when both can handle the task
# When true: Uses xAI for speed, falls back to MindOS for governance
# When false: Uses MindOS by default, xAI for exclusive features (x_search)
XAI_PREFER_AGENT_TOOLS=false

# Code execution timeout (milliseconds) - xAI supports up to 5 minutes
XAI_CODE_EXECUTION_TIMEOUT_MS=300000

# Optional: Remote MCP server for xAI mcp tool
# XAI_MCP_SERVER_URL=https://your-mcp-server.com
# XAI_MCP_SERVER_LABEL=custom-mcp

# -----------------------------------------------------------------------------
# On-Demand Tool Discovery
# -----------------------------------------------------------------------------
# Enable semantic tool discovery instead of loading all tools upfront
# Reduces token usage by 60-85% for typical tasks
ENABLE_ON_DEMAND_TOOLS=true

# Enable MCP-Zero style proactive tool requests from LLM
# When enabled, LLM can emit <tool_request> blocks to request additional tools
ENABLE_PROACTIVE_TOOL_DISCOVERY=true

# Number of tools to discover initially based on task goal (1-50)
TOOL_DISCOVERY_INITIAL_K=8

# Number of tools to add per expansion request (1-20)
TOOL_DISCOVERY_EXPANSION_K=5

# Minimum cosine similarity for tool matching (0.0-1.0)
# Higher values = more precise matches, lower values = broader discovery
TOOL_DISCOVERY_MIN_SIMILARITY=0.4

# Cache TTL for discovered tools (milliseconds)
TOOL_DISCOVERY_CACHE_TTL_MS=300000
